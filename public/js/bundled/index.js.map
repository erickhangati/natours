{"mappings":"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","sources":["public/js/alerts.js","public/js/login.js","public/js/mapbox.js","public/js/updateSettings.js","public/js/stripe.js","public/js/index.js"],"sourcesContent":["/* eslint-disable */\r\n\r\nexport const hideAlert = () => {\r\n  const el = document.querySelector('.alert');\r\n  if (el) el.parentElement.removeChild(el);\r\n};\r\n\r\n// Type is 'success' or 'error'\r\nexport const showAlert = (type, message) => {\r\n  hideAlert();\r\n  const markup = `<div class=\"alert alert--${type}\">${message}</div>`;\r\n  document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\r\n  window.setTimeout(hideAlert, 5000);\r\n};\r\n","/* eslint-disable */\r\n\r\nimport axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\nexport const login = async (email, password) => {\r\n  try {\r\n    const res = await axios({\r\n      method: 'POST',\r\n      url: '/api/v1/users/login',\r\n      data: {\r\n        email,\r\n        password,\r\n      },\r\n    });\r\n\r\n    if (res.data.status === 'success') {\r\n      showAlert('success', 'Logged in successfully.');\r\n      window.setTimeout(() => {\r\n        location.assign('/');\r\n      }, 1500);\r\n    }\r\n  } catch (err) {\r\n    showAlert('error', err.response.data.message);\r\n  }\r\n};\r\n\r\nexport const logout = async (req, res) => {\r\n  try {\r\n    const res = await axios({\r\n      method: 'GET',\r\n      url: '/api/v1/users/logout',\r\n    });\r\n    if (res.data.status === 'success') {\r\n      // location.reload(true);\r\n      location.assign('/');\r\n    }\r\n  } catch (err) {\r\n    showAlert('error', 'Error logging out! Try again.');\r\n  }\r\n};\r\n","/* eslint-disable */\r\n\r\nexport const displayMapbox = (locations) => {\r\n  mapboxgl.accessToken =\r\n    'pk.eyJ1IjoiZWtoYW5nYXRpIiwiYSI6ImNsNWo4YTg0cDBmazIzZHBsOHN3MG54aTYifQ.bkbk53VKr6JqQgrDRQhKCg';\r\n\r\n  const map = new mapboxgl.Map({\r\n    container: 'map',\r\n    style: 'mapbox://styles/ekhangati/cl5jof5xv00ng14ll3tr9gbf7',\r\n    scrollZoom: false,\r\n  });\r\n\r\n  const bounds = new mapboxgl.LngLatBounds();\r\n\r\n  locations.forEach((loc) => {\r\n    // Create a marker\r\n    const el = document.createElement('div');\r\n    el.className = 'marker';\r\n\r\n    // Add Marker\r\n    new mapboxgl.Marker({\r\n      element: el,\r\n      anchor: 'bottom',\r\n    })\r\n      .setLngLat(loc.coordinates)\r\n      .addTo(map);\r\n\r\n    // Add Popup Description\r\n    new mapboxgl.Popup({\r\n      offset: 40,\r\n    })\r\n      .setLngLat(loc.coordinates)\r\n      .setHTML(`<p>Day ${loc.day}: ${loc.description}</p>`)\r\n      .addTo(map);\r\n\r\n    //Extend map bounds to include current location\r\n    bounds.extend(loc.coordinates);\r\n  });\r\n\r\n  map.fitBounds(bounds, {\r\n    padding: {\r\n      top: 200,\r\n      bottom: 150,\r\n      left: 100,\r\n      right: 100,\r\n    },\r\n  });\r\n};\r\n","/* eslint-disable */\r\n\r\nimport axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\nexport const updateSettings = async (data, type) => {\r\n  try {\r\n    const urlEnd = type === 'data' ? 'update-me' : 'update-password';\r\n    const res = await axios({\r\n      method: 'PATCH',\r\n      url: `/api/v1/users/${urlEnd}`,\r\n      data,\r\n    });\r\n\r\n    if (res.data.status === 'success') {\r\n      showAlert(\r\n        'success',\r\n        `${type === 'data' ? 'Data' : 'Password'} updated successfully.`\r\n      );\r\n      window.setTimeout(() => {\r\n        location.reload(true);\r\n      }, 2000);\r\n    }\r\n  } catch (err) {\r\n    showAlert('error', err.response.data.message);\r\n  }\r\n};\r\n","/* eslint-disable */\r\nimport axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\nconst stripe = Stripe(\r\n  'pk_test_51LOHBLHi7CwhwoFLJHeVEPd5M1q39XQlsKF7EmeIyds7GkaDwLAVVTka1KWqj1vFwwOWh8Ywfi6eMoSaK9Y3jBm000HazB8Wj1'\r\n);\r\n\r\nexport const bookTour = async (tourId) => {\r\n  try {\r\n    // 1) Get checkout session from api\r\n    const session = await axios({\r\n      method: 'GET',\r\n      url: `/api/v1/bookings/checkout-session/${tourId}`,\r\n    });\r\n\r\n    // 2) Create checkout form + charge credit card\r\n    await stripe.redirectToCheckout({\r\n      sessionId: session.data.session.id,\r\n    });\r\n  } catch (err) {\r\n    showAlert('error', err.response.data.message);\r\n  }\r\n};\r\n","/* eslint-disable */\r\nimport '@babel/polyfill';\r\nimport { login, logout } from './login';\r\nimport { displayMapbox } from './mapbox';\r\nimport { updateSettings } from './updateSettings';\r\nimport { bookTour } from './stripe';\r\n\r\n// DOM ELEMENTS\r\nconst mapBox = document.getElementById('map');\r\nconst loginForm = document.querySelector('.form--login');\r\nconst logOutBtn = document.querySelector('.nav__el--logout');\r\nconst userDataForm = document.querySelector('.form-user-data');\r\nconst userSettingsForm = document.querySelector('.form-user-settings');\r\nconst bookTourBtn = document.getElementById('book-tour');\r\n\r\n// DELEGATION\r\nif (mapBox) {\r\n  const locations = JSON.parse(mapBox.dataset.locations);\r\n  displayMapbox(locations);\r\n}\r\n\r\nif (loginForm)\r\n  loginForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const email = document.getElementById('email').value;\r\n    const password = document.getElementById('password').value;\r\n    login(email, password);\r\n  });\r\n\r\nif (logOutBtn) logOutBtn.addEventListener('click', logout);\r\n\r\nif (userDataForm)\r\n  userDataForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const form = new FormData();\r\n    form.append('name', document.getElementById('name').value);\r\n    form.append('email', document.getElementById('email').value);\r\n    form.append('photo', document.getElementById('photo').files[0]);\r\n    updateSettings(form, 'data');\r\n  });\r\n\r\nif (userSettingsForm)\r\n  userSettingsForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const oldPassword = document.getElementById('password-current').value;\r\n    const newPassword = document.getElementById('password').value;\r\n    const confirmNewPassword =\r\n      document.getElementById('password-confirm').value;\r\n\r\n    updateSettings(\r\n      { oldPassword, newPassword, confirmNewPassword },\r\n      'password'\r\n    );\r\n  });\r\n\r\nif (bookTourBtn)\r\n  bookTourBtn.addEventListener('click', (e) => {\r\n    e.target.textContent = 'Processing...';\r\n    const { tourId } = e.target.dataset;\r\n    bookTour(tourId);\r\n  });\r\n"],"names":["$f58a45738b9cb47f$export$516836c6a9dfc573","el","document","querySelector","parentElement","removeChild","$f58a45738b9cb47f$export$de026b00723010c1","type","message","markup","insertAdjacentHTML","window","setTimeout","$1d7098f35fbc6738$export$596d806903d1f59e","async","email","password","$parcel$interopDefault","$iLt4j$axios","method","url","data","status","location","assign","err","response","$4d9992e371648812$export$519af21206474b10","locations","mapboxgl","accessToken","map","Map","container","style","scrollZoom","bounds","LngLatBounds","forEach","loc","createElement","className","Marker","element","anchor","setLngLat","coordinates","addTo","Popup","offset","setHTML","day","description","extend","fitBounds","padding","top","bottom","left","right","$36d3f66e349590da$export$f558026a994b6051","urlEnd","reload","$0d4c73e6d28bf144$var$stripe","Stripe","$0d4c73e6d28bf144$export$8d5bdbf26681c0c2","tourId","session","redirectToCheckout","sessionId","id","$4e974e50cdb6013f$var$mapBox","getElementById","$4e974e50cdb6013f$var$loginForm","$4e974e50cdb6013f$var$logOutBtn","$4e974e50cdb6013f$var$userDataForm","$4e974e50cdb6013f$var$userSettingsForm","$4e974e50cdb6013f$var$bookTourBtn","JSON","parse","dataset","addEventListener","e","preventDefault","value","req","res","form","FormData","append","files","oldPassword","newPassword","confirmNewPassword","target","textContent"],"version":3,"file":"index.js.map","sourceRoot":"../../../"}